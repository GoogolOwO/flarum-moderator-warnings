module.exports=function(n){var t={};function r(a){if(t[a])return t[a].exports;var e=t[a]={i:a,l:!1,exports:{}};return n[a].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=n,r.c=t,r.d=function(n,t,a){r.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:a})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var e in n)r.d(a,e,function(t){return n[t]}.bind(null,e));return a},r.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r.p="",r(r.s=32)}([function(n,t){n.exports=flarum.core.compat.app},function(n,t){n.exports=flarum.core.compat.Model},function(n,t){n.exports=flarum.core.compat.extend},function(n,t){n.exports=flarum.core.compat.Component},function(n,t){n.exports=flarum.core.compat["helpers/username"]},function(n,t){n.exports=flarum.core.compat["components/Button"]},function(n,t){n.exports=flarum.core.compat["utils/ItemList"]},function(n,t){n.exports=flarum.core.compat["models/User"]},function(n,t){n.exports=flarum.core.compat["components/UserPage"]},function(n,t){n.exports=flarum.core.compat["helpers/humanTime"]},function(n,t){n.exports=flarum.core.compat["components/NotificationGrid"]},function(n,t){n.exports=flarum.core.compat["utils/PostControls"]},function(n,t){n.exports=flarum.core.compat["utils/UserControls"]},function(n,t){n.exports=flarum.core.compat["components/Alert"]},function(n,t){n.exports=flarum.core.compat["components/Modal"]},function(n,t){n.exports=flarum.core.compat["components/LinkButton"]},function(n,t){n.exports=flarum.core.compat["components/LoadingIndicator"]},function(n,t){n.exports=flarum.core.compat["helpers/avatar"]},function(n,t){n.exports=flarum.core.compat["utils/classList"]},function(n,t){n.exports=flarum.core.compat["components/Dropdown"]},function(n,t){n.exports=flarum.core.compat["components/PostPreview"]},function(n,t){n.exports=flarum.core.compat["components/Separator"]},function(n,t){n.exports=flarum.core.compat["helpers/listItems"]},function(n,t){n.exports=flarum.core.compat["models/Post"]},function(n,t){n.exports=flarum.core.compat["components/CommentPost"]},function(n,t){n.exports=flarum.core.compat["helpers/icon"]},function(n,t){n.exports=flarum.core.compat["components/Notification"]},function(n,t){n.exports=flarum.core.compat["utils/computed"]},,function(n,t){n.exports=flarum.core},function(n,t){n.exports=flarum.core.compat["helpers/fullTime"]},function(n,t){n.exports=flarum.core.compat["utils/string"]},function(n,t,r){"use strict";r.r(t);var a=r(0),e=r.n(a),o=r(10),s=r.n(o),i=(r(29),r(2)),c=r(7),u=r.n(c),p=r(1),l=r.n(p),d=r(11),f=r.n(d),h=r(12),g=r.n(h),v=r(5),w=r.n(v);function b(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}var _=r(13),k=r.n(_),y=r(14),x=r.n(y),C=r(4),W=r.n(C),N=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.init=function(){n.prototype.init.call(this),this.publicComment=m.prop(""),this.privateComment=m.prop(""),this.strikes=m.prop(0)},r.className=function(){return"WarningsModal Modal--large"},r.title=function(){return app.translator.trans("askvortsov-moderator-warnings.forum.warning_modal.heading",{username:W()(this.props.user)})},r.content=function(){return console.log,m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("askvortsov-moderator-warnings.forum.warning_modal.strikes_heading"),m("input",{type:"number",className:"FormControl",value:this.strikes(),min:"0",max:"5",oninput:m.withAttr("value",this.strikes)})))),m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("askvortsov-moderator-warnings.forum.warning_modal.public_comment_heading",{username:W()(this.props.user)}),m("textarea",{className:"FormControl",value:this.publicComment(),required:!0,oninput:m.withAttr("value",this.publicComment),rows:"6"})))),m("div",{className:"Form-group"},m("div",null,m("label",null,app.translator.trans("askvortsov-moderator-warnings.forum.warning_modal.private_comment_heading",{username:W()(this.props.user)}),m("textarea",{className:"FormControl",value:this.privateComment(),oninput:m.withAttr("value",this.privateComment),rows:"6"})))),m("div",{className:"Form-group"},m(w.a,{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("askvortsov-moderator-warnings.forum.warning_modal.submit_button")))))},r.onsubmit=function(n){n.preventDefault(),app.alerts.dismiss(this.successAlert),this.loading=!0,this.strikes()||this.strikes(0);var t={userId:this.props.user.id(),strikes:this.strikes(),public_comment:this.publicComment(),private_comment:this.privateComment()};this.props.post&&(t.post=this.props.post),app.store.createRecord("warnings").save(t).then(this.hide.bind(this)).then(app.alerts.show(this.successAlert=new k.a({type:"success",children:app.translator.trans("askvortsov-moderator-warnings.forum.warning_modal.confirmation_message")}))).then(this.props.callback).catch((function(){}))},t}(x.a),P=r(8),A=r.n(P),O=r(15),I=r.n(O);function L(){return(L=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n}).apply(this,arguments)}var M=r(3),U=r.n(M),B=r(16),j=r.n(B),D=r(17),T=r.n(D),F=(r(30),r(9)),H=r.n(F),S=r(18),R=r.n(S),V=r(19),z=r.n(V),E=r(20),q=r.n(E),G=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.view=function(){return m("div",{className:"WarningPost"},m("ul",{class:"Dropdown-menu PostPreview-preview fade in"},m("li",null,q.a.component({post:this.props.post}))))},r.config=function(n){n||this.$(".PostPreview-preview").show().css("position","relative")},t}(U.a),J=r(21),K=r.n(J),Q=r(6),X=r.n(Q),Y={controls:function(n,t){var r=this,a=new X.a;return["user","moderation","destructive"].forEach((function(e){var o=r[e+"Controls"](n,t).toArray();o.length&&(o.forEach((function(n){return a.add(n.itemName,n)})),a.add(e+"Separator",K.a.component()))})),a},userControls:function(n,t){return new X.a},moderationControls:function(n,t){return new X.a},destructiveControls:function(n,t){var r=new X.a;return!n.isHidden()&&app.session.user.canManageWarnings()&&r.add("hide",w.a.component({icon:"far fa-trash-alt",children:app.translator.trans("askvortsov-moderator-warnings.forum.warning_controls.delete_button"),onclick:this.hideAction.bind(n)})),n.isHidden()&&app.session.user.canManageWarnings()&&r.add("restore",w.a.component({icon:"fas fa-reply",children:app.translator.trans("askvortsov-moderator-warnings.forum.warning_controls.restore_button"),onclick:this.restoreAction.bind(n)})),n.isHidden()&&app.session.user.canDeleteWarnings()&&r.add("delete",w.a.component({icon:"fas fa-times",children:app.translator.trans("askvortsov-moderator-warnings.forum.warning_controls.delete_forever_button"),onclick:this.deleteAction.bind(n,t)})),r},hideAction:function(){return this.pushAttributes({hiddenAt:new Date,hiddenUser:app.session.user}),this.save({isHidden:!0}).then((function(){return m.redraw()}))},restoreAction:function(){return this.pushAttributes({hiddenAt:null,hiddenUser:null}),this.save({isHidden:!1}).then((function(){return m.redraw()}))},deleteAction:function(n){return n&&(n.loading=!0),this.delete().then((function(){})).catch((function(){})).then((function(){n&&(n.loading=!1),location.reload()}))}},Z=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.view=function(){var n=this.props.warning,t=n.addedByUser(),r=Y.controls(n,this).toArray(),a=this.attrs();return m("div",a,r.length?z.a.component({icon:"fas fa-ellipsis-v",children:r,className:"WarningListItem-controls",buttonClassName:"Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right"}):"",m("div",{className:"WarningListItem-main"},m("h3",{className:"WarningListItem-title"},m("a",{href:t?app.route.user(t):"#",className:"WarningListItem-author",config:function(n){$(n).tooltip({placement:"right"}),m.route.apply(this,arguments)}},T()(t)," ",W()(t))),m("span",{class:"WarningListItem-strikes"},n.isHidden()?app.translator.transChoice("askvortsov-moderator-warnings.forum.warning_list_item.list_item_heading_hidden",n.strikes(),{time:H()(n.createdAt()),strikes:n.strikes()||"0"}):app.translator.transChoice("askvortsov-moderator-warnings.forum.warning_list_item.list_item_heading",n.strikes(),{time:H()(n.createdAt()),strikes:n.strikes()||"0"})),m("hr",null),m("ul",{className:"WarningListItem-info"},n.post()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.linked_post")),G.component({post:n.post()})):"",m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.public_comment")),m("p",{class:"WarningListItem-comment"},m.trust(n.public_comment()))),app.session.user.canManageWarnings()&&n.private_comment()?m("li",{className:"item-excerpt"},m("h3",{className:"WarningListItem-subtitle"},app.translator.trans("askvortsov-moderator-warnings.forum.warning_list_item.private_comment")),m("p",{class:"WarningListItem-comment"},m.trust(n.private_comment()))):"")))},r.attrs=function(){var n=this.props.warning,t={};return t.className=(t.className||"")+" "+R()({WarningListItem:!0,"WarningListItem--hidden":n.isHidden()}),t},t}(U.a),nn=r(22),tn=r.n(nn),rn=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.init=function(){n.prototype.init.call(this),this.loading=!0,this.warnings=[],this.user=this.props.params.user,this.refresh()},r.view=function(){var n;return this.loading&&(n=j.a.component()),m("div",{className:"WarningList"},m("h1",{className:"WarningList-warnings"},this.strikeCount()?e.a.translator.transChoice("askvortsov-moderator-warnings.forum.warning_list.warnings",this.strikeCount(),{strikes:this.strikeCount()||"0"}):e.a.translator.trans("askvortsov-moderator-warnings.forum.warning_list.warnings_no_strikes")),m("div",{class:"Warnings-toolbar"},m("ul",{className:"Warnings-toolbar-action"},tn()(this.actionItems().toArray()))),m("ul",{className:"WarningList-Warnings"},this.warnings.map((function(n){return m("li",{key:n.id(),"data-id":n.id()},Z.component({warning:n}))})),!this.loading&&0===this.warnings.length&&m("label",null,e.a.translator.trans("askvortsov-moderator-warnings.forum.warning_list.no_warnings"))),m("div",{className:"WarningList-loadMore"},n))},r.actionItems=function(){var n=new X.a;return e.a.session.user.canManageWarnings()&&n.add("create_warning",w.a.component({children:e.a.translator.trans("askvortsov-moderator-warnings.forum.warning_list.add_button"),className:"Button Button--primary",onclick:this.handleOnClickCreate.bind(this)})),n},r.strikeCount=function(){return this.warnings.filter((function(n){return!n.isHidden()})).map((function(n){return n.strikes()})).reduce((function(n,t){return n+t}),0)},r.parseResults=function(n){return[].push.apply(this.warnings,n),this.loading=!1,m.lazyRedraw(),n},r.refresh=function(){var n=this;return e.a.store.find("warnings",this.user.id()).catch((function(){})).then((function(t){n.warnings=[],n.parseResults(t)}))},r.handleOnClickCreate=function(n){n.preventDefault(),e.a.modal.show(new N(L({callback:this.refresh.bind(this)},this.props.params)))},t}(U.a),an=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.init=function(){n.prototype.init.call(this),this.loadUser(m.route.param("username"))},r.content=function(){if(app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0))return m("div",{className:"WarningsUserPage"},rn.component({params:{user:this.user,sort:"newest"}}))},t}(A.a),en=function(){app.routes["user.warnings"]={path:"/u/:username/warnings",component:an.component()},Object(i.extend)(A.a.prototype,"navItems",(function(n){app.session.user&&(app.session.user.canViewWarnings()||this.user.id()===app.session.user.id()&&this.user.visibleWarningCount()>0)&&n.add("warnings",I.a.component({href:app.route("user.warnings",{username:this.user.username()}),children:[app.translator.trans("askvortsov-moderator-warnings.forum.user.warnings"),this.user.visibleWarningCount()>0?m("span",{className:"Button-badge"},this.user.visibleWarningCount()):""],icon:"fas fa-exclamation-circle"}),10)}))},on=r(23),sn=r.n(on),cn=r(24),un=r.n(cn),mn=r(25),pn=r.n(mn),ln=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.init=function(){n.prototype.init.call(this),this.warning=this.props.warning},r.view=function(){return m("a",{className:"WarningPreview",href:app.route("user.warnings",{username:this.warning.warnedUser().username()}),config:m.route},m(Z,{warning:this.warning}))},t}(U.a),dn=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.init=function(){n.prototype.init.call(this),this.warning=this.props.warning},r.view=function(){return m("div",{className:"Post-warning"},m("span",{className:"Post-warning-summary"},pn()("fas fa-exclamation-circle"),this.warning.strikes()?app.translator.transChoice("askvortsov-moderator-warnings.forum.post.warning",this.warning.strikes(),{strikes:this.warning.strikes()||"0",mod_username:W()(this.warning.addedByUser())}):app.translator.trans("askvortsov-moderator-warnings.forum.post.warning_no_strikes",{mod_username:W()(this.warning.addedByUser())})))},r.config=function(n){var t=this;if(!n){var r,a=this.warning,e=function(){t.$(".Post-warning-preview").removeClass("in").one("transitionend",(function(){$(this).hide()}))},o=$('<ul class="Dropdown-menu Post-warning-preview fade"/>');this.$().append(o),this.$().children().hover((function(){clearTimeout(r),r=setTimeout((function(){!o.hasClass("in")&&o.is(":visible")||(m.render(o[0],m("li",{"data-id":a.id()},ln.component({warning:a}))),o.show(),setTimeout((function(){return o.off("transitionend").addClass("in")})))}),200)}),(function(){clearTimeout(r),r=setTimeout(e,250)})),$(".Post-warning").find(".Post-warning-summary a").hover((function(){$(".Post-warning").find('[data-number="'+$(this).data("number")+'"]').addClass("active")}),(function(){$(".Post-warning").find("[data-number]").removeClass("active")}))}},t}(U.a),fn=function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.init=function(){n.prototype.init.call(this),this.post=this.props.post},r.view=function(){return m("div",{className:"Post-warning-list"},this.props.post.warnings().map((function(n){return dn.component({warning:n})})))},t}(U.a);var hn=r(26),gn=r.n(hn),vn=(r(31),function(n){function t(){return n.apply(this,arguments)||this}b(t,n);var r=t.prototype;return r.icon=function(){return"fas fa-exclamation-circle"},r.href=function(){return app.route("user.warnings",{username:app.session.user.username()})},r.content=function(){var n=this.props.notification.subject();return n.strikes()?app.translator.transChoice("askvortsov-moderator-warnings.forum.notifications.warning_text",n.strikes(),{mod_username:W()(this.props.notification.fromUser()),strikes:n.strikes()||"0"}):app.translator.trans("askvortsov-moderator-warnings.forum.notifications.warning_no_strikes_text",{mod_username:W()(this.props.notification.fromUser())})},t}(gn.a)),wn=r(27),bn=r.n(wn),_n=function(n){function t(){return n.apply(this,arguments)||this}return b(t,n),t}(l.a);L(_n.prototype,{id:l.a.attribute("id"),public_comment:l.a.attribute("public_comment"),private_comment:l.a.attribute("private_comment"),strikes:l.a.attribute("strikes"),createdAt:l.a.attribute("createdAt",l.a.transformDate),isHidden:bn()("hiddenAt",(function(n){return!!n})),hiddenAt:l.a.attribute("hiddenAt",l.a.transformDate),warnedUser:l.a.hasOne("warnedUser"),hiddenByUser:l.a.hasOne("hiddenByUser"),addedByUser:l.a.hasOne("addedByUser"),post:l.a.hasOne("post")}),e.a.initializers.add("askvortsov/flarum-moderator-warnings",(function(n){n.store.models.warnings=_n,u.a.prototype.canViewWarnings=l.a.attribute("canViewWarnings"),u.a.prototype.canManageWarnings=l.a.attribute("canManageWarnings"),u.a.prototype.canDeleteWarnings=l.a.attribute("canDeleteWarnings"),u.a.prototype.visibleWarningCount=l.a.attribute("visibleWarningCount"),Object(i.extend)(f.a,"moderationControls",(function(n,t){e.a.session.user&&e.a.session.user.canManageWarnings()&&n.add("warning",m(w.a,{icon:"fas fa-exclamation-circle",onclick:function(){return e.a.modal.show(new N({callback:function(){location.reload()},user:t.user(),post:t}))}},e.a.translator.trans("askvortsov-moderator-warnings.forum.post_controls.warning_button")))})),Object(i.extend)(g.a,"moderationControls",(function(n,t){e.a.session.user&&e.a.session.user.canManageWarnings()&&n.add("warning",m(w.a,{icon:"fas fa-exclamation-circle",onclick:function(){return e.a.modal.show(new N({callback:function(){location.reload()},user:t}))}},e.a.translator.trans("askvortsov-moderator-warnings.forum.post_controls.warning_button")))})),en(),sn.a.prototype.warnings=l.a.hasMany("warnings"),Object(i.extend)(un.a.prototype,"footerItems",(function(n){var t=this.props.post;t.warnings()&&n.add("warnings",fn.component({post:t}))})),n.notificationComponents.warning=vn,Object(i.extend)(s.a.prototype,"notificationTypes",(function(t){t.add("warning",{name:"warning",icon:"fas fa-exclamation-circle",label:n.translator.trans("askvortsov-moderator-warnings.forum.settings.warning_notification_label")})}))}))}]);
//# sourceMappingURL=forum.js.map